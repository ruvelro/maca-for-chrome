<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>maca - Opciones</title>
  <link rel="stylesheet" href="options.css" />
</head>
<body>

  <h1>maca</h1>
  <div class="subtitle">Media ALT & Caption AI for SEO</div>

  <!-- GENERAL -->
  <div class="section">
    <h2>General</h2>

    <div class="field">
      <label for="language">Idioma de salida</label>
      <select id="language">
        <option value="es-ES">Español (España)</option>
        <option value="es">Español</option>
        <option value="en">English</option>
        <option value="fr">Français</option>
        <option value="de">Deutsch</option>
      </select>
      <div class="help">Idioma en el que se generarán ALT y leyenda.</div>
    </div>

    <div class="field" style="margin-top:10px;">
      <label style="display:flex; gap:10px; align-items:center;">
        <input type="checkbox" id="languageAutoEsEs" style="width:auto; margin:0;" />
        Auto-idioma: forzar Español (España)
      </label>
      <div class="help">Desactivado por defecto. Si lo activas, maca generará siempre en <b>es-ES</b> aunque elijas otro idioma.</div>
    </div>

    <div class="field">
      <label for="seoProfile">Perfil SEO</label>
      <select id="seoProfile">
        <option value="blog">Blog / Editorial</option>
        <option value="product">Producto</option>
        <option value="person">Persona</option>
        <option value="graphic">Gráfico / Infografía</option>
        <option value="logo">Marca / Logo</option>
      </select>
      <div class="help">Ajusta automáticamente el tono y el enfoque SEO.</div>
    </div>
  </div>

    <!-- PROVEEDOR -->
  <div class="section">
    <h2>Proveedor de IA</h2>

    <div class="row">
      <div class="field">
        <label for="provider">Proveedor</label>
        <select id="provider">
          <option value="openai">OpenAI</option>
          <option value="gemini">Gemini</option>
          <option value="anthropic">Anthropic</option>
          <option value="groq">Groq</option>
          <option value="openrouter">OpenRouter</option>
          <option value="local_ollama">Local (Ollama · visión)</option>
          <option value="local_openai">Local (OpenAI-compatible)</option>
        </select>
      </div>

      <!-- Model selector for cloud providers -->
      <div class="field" id="cloudModelField">
        <label for="model">Modelo</label>
        <select id="model"></select>
        <input type="text" id="customModel" placeholder="(opcional) Modelo personalizado" />
        <div class="help">Si escribes un modelo aquí, se usará este en lugar del desplegable.</div>
      </div>
    </div>

    <!-- Local settings (shown only for local providers) -->
    <div class="row" id="localRow" style="display:none;">
      <div class="field" id="localEndpointField">
        <label for="localEndpoint">Endpoint local</label>
        <input type="text" id="localEndpoint" placeholder="http://127.0.0.1:11434 (Ollama)  ·  http://127.0.0.1:1234/v1 (OpenAI-compatible)" />
        <div class="help">Debe ser accesible desde el navegador (localhost o IP LAN).</div>
      </div>

      <div class="field" id="localModelField">
        <label for="localModel">Modelo local</label>
        <input type="text" id="localModel" placeholder="Ej: llava:7b  ·  qwen2.5-vl  ·  tu-modelo" />
        <div class="help">Necesitas un modelo con visión (multimodal) para analizar imágenes.</div>
      </div>
    </div>

    <div class="field" id="apiKeyField">
      <label for="apiKey" id="apiKeyLabel">API key</label>
      <input type="password" id="apiKey" placeholder="Pega aquí tu API key" />
      <div class="help" id="apiKeyHelp">La clave se guarda solo en tu navegador.</div>

      <div class="field" id="syncApiKeyRow" style="margin-top:10px;">
        <label style="display:flex; gap:10px; align-items:center;">
          <input type="checkbox" id="syncApiKey" style="width:auto; margin:0;" />
          Sincronizar API key con Google (Chrome)
        </label>
        <div class="help">Si lo desactivas, la API key se guarda solo en este dispositivo. Recomendado para más privacidad.</div>
      </div>
    </div>
  </div>

  <!-- AVANZADO -->
  <div class="section">
    <h2>Avanzado</h2>

    <div class="field">
      <label style="display:flex; gap:10px; align-items:center;">
        <input type="checkbox" id="wpAutoApply" style="width:auto; margin:0;" />
        Pegar automáticamente en WordPress al terminar
      </label>
      <div class="help">
        Cuando maca genera el ALT y la leyenda, los insertará automáticamente en los campos
        <b>Texto alternativo</b> y <b>Leyenda</b> del modal de la Biblioteca de medios.
        Desactivado por defecto.
      </div>
	    </div>

    <div class="field" style="margin-top:10px;">
      <label style="display:flex; gap:10px; align-items:center;">
        <input type="checkbox" id="wpAutoApplyRequireMedia" style="width:auto; margin:0;" />
        Autopaste solo si detecta el modal de Medios o la pantalla de detalles abierta
      </label>
      <div class="help">
        Evita pegar textos si estás en otra pantalla de wp-admin. Si lo desactivas, intentará pegar siempre que encuentre campos compatibles.
      </div>
    </div>

    <div class="field" style="margin-top:10px;">
      <label style="display:flex; gap:10px; align-items:center;">
        <input type="checkbox" id="wpAutoAnalyzeOnUpload" style="width:auto; margin:0;" />
        Auto-generar metadatos al subir varias imágenes
      </label>
      <div class="help">
        Experimental. Se activa cuando detecta una subida múltiple en la Biblioteca de medios y genera/rellena ALT, title y leyenda automáticamente.
      </div>
    </div>
    <div class="field" style="margin-top:10px;">
      <label style="display:flex; gap:10px; align-items:center;">
        <input type="checkbox" id="autoAnalyzeOnSelectMedia" style="width:auto; margin:0;" />
        Auto-generar al seleccionar una imagen en Medios
      </label>
      <div class="help">
        Opcional y desactivado por defecto. Si lo activas, al seleccionar una imagen en la biblioteca se lanzará la generación automática.
      </div>
    </div>
    <div class="field" style="margin-top:10px;">
      <label style="display:flex; gap:10px; align-items:center;">
        <input type="checkbox" id="autoDeselectProcessedOnAutoFill" style="width:auto; margin:0;" />
        Deseleccionar automáticamente las imágenes ya procesadas
      </label>
      <div class="help">
        Opcional para subidas múltiples. Tras rellenar ALT, title y leyenda de una imagen, se desmarca para que veas de un vistazo cuáles faltan.
      </div>
    </div>

    
    <div class="field" style="margin-top:10px;">
      <label style="display:flex; gap:10px; align-items:center;">
        <input type="checkbox" id="shortcutEnabled" style="width:auto; margin:0;" />
        Activar atajo de teclado para ejecutar maca
      </label>
      <div class="help">
        Permite ejecutar maca sin botón derecho. Se intentará detectar la imagen seleccionada/abierta en la Biblioteca de medios o en Detalles de la imagen.
        El atajo se configura en <b>Chrome → Extensiones → Atajos de teclado</b>.
      </div>
      <div class="row" style="margin-top:8px; align-items:center;">
        <div class="field" style="margin:0;">
          <button id="openShortcuts" type="button" class="secondary">Configurar atajo</button>
        </div>
        <div class="field" style="margin:0;">
          <div class="help" style="margin:0;">Atajo actual: <b id="shortcutCurrent">-</b></div>
        </div>
      </div>
    </div>

<div class="row" style="margin-top:10px;">
      <div class="field">
        <label for="generateMode">Qué generar</label>
        <select id="generateMode">
          <option value="both">ALT, title y leyenda</option>
          <option value="alt">ALT y title</option>
          <option value="caption">Solo leyenda</option>
        </select>
        <div class="help">Ahorra tiempo y tokens cuando solo necesitas uno de los campos.</div>
      </div>

      <div class="field">
        <label for="altMaxLength">Longitud máxima del ALT</label>
        <input id="altMaxLength" type="number" min="0" step="1" placeholder="125" />
        <div class="help">0 = sin límite. Por defecto 125.</div>
      </div>
    </div>

    <div class="field" style="margin-top:10px;">
      <label style="display:flex; gap:10px; align-items:center;">
        <input type="checkbox" id="avoidImagePrefix" style="width:auto; margin:0;" />
        Evitar "imagen/foto de..." al inicio del ALT
      </label>
      <div class="help">Recomendado para accesibilidad y SEO. Si lo desactivas, no se eliminarán esos prefijos.</div>
    </div>

    <div class="field" style="margin-top:10px;">
      <label style="display:flex; gap:10px; align-items:center;">
        <input type="checkbox" id="allowDecorativeAltEmpty" style="width:auto; margin:0;" />
        Permitir ALT vacío si la imagen es decorativa
      </label>
      <div class="help">Desactivado por defecto. La IA marcará <b>"decorativa": true</b> cuando corresponda y se permitirá ALT vacío solo en ese caso.</div>
    </div>

    <div class="field" style="margin-top:10px;">
      <label style="display:flex; gap:10px; align-items:center;">
        <input type="checkbox" id="captionTemplateEnabled" style="width:auto; margin:0;" />
        Usar plantilla para la leyenda
      </label>
      <div class="help">Desactivado por defecto. Variables: <b>{{caption}}</b>, <b>{{alt}}</b>, <b>{{filename}}</b>, <b>{{site}}</b>, <b>{{date}}</b>.</div>
      <textarea id="captionTemplate" rows="3" placeholder="{{caption}}"></textarea>
    </div>
    <div class="field" style="margin-top:10px;">
      <label for="captionSignatureText">Texto de firma para leyenda (opción con firma)</label>
      <input id="captionSignatureText" type="text" placeholder="Ej: Foto: @tuusuario" />
      <div class="help">Se añade al final de la leyenda solo cuando usas la opción "Analizar y rellenar con firma" del menú contextual.</div>
    </div>
    <div class="field" style="margin-top:10px;">
      <label style="display:flex; gap:10px; align-items:center;">
        <input type="checkbox" id="autoCaptionSignatureOnAutoFill" style="width:auto; margin:0;" />
        Añadir firma en leyenda cuando se rellena automáticamente
      </label>
      <div class="help">Si está activado, la auto-generación/autorrelleno (auto-subida, lote y autopaste) añadirá también el texto de firma al final de la leyenda.</div>
    </div>


    <div class="field" style="margin-top:10px;">
      <label style="display:flex; gap:10px; align-items:center;">
        <input type="checkbox" id="debugEnabled" style="width:auto; margin:0;" />
        Modo debug (diagnóstico)
      </label>
      <div class="help">Desactivado por defecto. Guarda eventos recientes para ayudarte a diagnosticar fallos. No guarda API keys.</div>
    </div>

    <div class="row">
      <div class="field">
        <label for="onCompleteAction">Al terminar la generación</label>
        <select id="onCompleteAction">
          <option value="none">No hacer nada</option>
          <option value="minimize">Minimizar (barra inferior)</option>
          <option value="close">Cerrar overlay</option>
        </select>
        <div class="help">Acción automática tras generar (y, si está activado, después de pegar en WordPress).</div>

        <div style="margin-top:10px;">
          <label for="onCompleteScope">Aplicar esta acción</label>
          <select id="onCompleteScope">
            <option value="wp">Solo en WordPress (wp-admin)</option>
            <option value="all">En cualquier web</option>
          </select>
          <div class="help">Útil si también usas maca fuera de WordPress y no quieres que se minimice siempre.</div>
        </div>
      </div>

      <div class="field">
        <label for="historyLimit">Historial (máximo de elementos)</label>
        <select id="historyLimit">
          <option value="5">5</option>
          <option value="10">10</option>
          <option value="25">25</option>
          <option value="50">50</option>
          <option value="0">Ilimitado</option>
        </select>
        <div class="help">"Ilimitado" guardará hasta que Chrome alcance su cuota de almacenamiento.</div>
      </div>

          <div class="field" style="margin-top:10px;">
        <label style="display:flex; gap:10px; align-items:center;">
          <input type="checkbox" id="historyEnabled" style="width:auto; margin:0;" checked />
          Guardar historial de resultados
        </label>
        <div class="help">Desactivado: no se guardarán nuevos resultados en el historial (el popup quedará vacío).</div>
      </div>

    </div>

    <div class="field">
      <label for="prompt">Prompt personalizado (opcional)</label>
      <textarea id="prompt" placeholder="Deja vacío para usar el prompt por defecto"></textarea>
      <div class="help">
        Puedes personalizar el prompt si sabes lo que haces.
        Si escribes un prompt personalizado, sustituye al prompt del perfil SEO.
      </div>
    </div>
  </div>
<!-- HERRAMIENTAS -->
  <div class="section">
    <h2>Herramientas</h2>
    <button id="testConfig" class="secondary">Probar configuración</button>
    <button id="clearHistory" class="secondary">Vaciar historial</button>
    <button id="copyDebug" class="secondary">Copiar diagnóstico</button>
    <button id="copySupport" class="secondary">Copiar soporte (diagnóstico + config)</button>
    <button id="clearDebug" class="secondary">Borrar diagnóstico</button>
    <div class="help" style="margin-top:10px;">La prueba hace una petición mínima para validar tu API key / endpoint y el modelo seleccionado.</div>
  </div>

  <!-- ACCIONES -->
  <div class="section">
    <button id="save">Guardar cambios</button>
    <button id="reset" class="secondary">Restablecer</button>
    <div class="footer" id="status"></div>
  </div>

  <!-- PRIVACIDAD -->
  <div class="section" id="privacy">
    <h2>Privacidad</h2>
    <div class="privacy">
      <p>
        <b>maca</b> funciona de forma local en tu navegador. No usamos analítica ni tracking.
      </p>
      <ul>
        <li><b>API key:</b> se guarda en tu navegador. Si activas "Sincronizar API key con Google (Chrome)", se guardará en <code>chrome.storage.sync</code> y se sincronizará con tu perfil de Chrome.</li>
        <li><b>Imágenes:</b> para generar el ALT/leyenda, la imagen (o una versión reducida) se envía al proveedor que elijas (OpenAI/Gemini o tu endpoint local). No se envían cookies ni credenciales.</li>
        <li><b>Historial:</b> se guarda en tu dispositivo (y puedes desactivarlo o vaciarlo cuando quieras).</li>
        <li><b>Modo debug:</b> guarda eventos recientes para diagnóstico y nunca incluye tu API key.</li>
      </ul>
      <p class="help" style="margin-top:8px;">
        Recomendación: si trabajas en un equipo compartido, desactiva la sincronización y usa solo almacenamiento local.
      </p>
    </div>
  </div>

  <script type="module" src="options.js"></script>
</body>
</html>
